[Previous Page - Downloads](Downloads.html)

<html>
  <head>




  </head>



  <body>
    <div class="se-pre-con"></div>



<div id="editor"></div>


<div id="title" style="width:1200px; margin:10 auto;">



</div>

<div id="content" style="width:1200px; margin:10 auto;">

    

   <ol id='app'></ol> 
   
</div>




    <script type="text/javascript">

      //Make API call to HAPI FHIR server to get a Protocol Questionnaire Resource

 var apiUrl='http://localhost:8080/hapi-fhir-jpaserver/fhir/QuestionnaireResponse/21203';     
fetch(apiUrl).then(response=> {
        return response.json();
      }).then(data1 => {
       titlePage(data1.item,document.getElementById("title"));

            //LForms.Util.mergeFHIRDataIntoLForms(QuestionnaireResponse, fhirData, data, R4)
    
    // Turn off the top-level questions and controls (optional)
    lformsQ1.templateOptions = {
      showFormHeader: false,
      hideFormControls: true
    };
    
    // Add the form to the page
    LForms.Util.addFormToPage(lformsQ1, formContainer);
    
 
    
   




        console.log(data);
      }).catch(err=>{


      });









function titlePage(orgData,targetUL) {
  var i;
  for (i = 0; i < orgData.length; i++) 

  {
    /*
    if (orgData[i].hasOwnProperty('text') && orgData[i].linkId =="8") {
      // Take out the text from the .name property
      var nameText = document.createTextNode(orgData[i].text);
      // Define a new <li> tag
      var strong = document.createElement('h1');
       strong.appendChild(nameText);
      //var newLI = document.createElement('li');
      // Append text to new <li> tage - newLI
      // Append element to <ul> tag
      targetUL.appendChild(nameText);
    }
    */
 if (orgData[i].hasOwnProperty('valueString')  ) {
      // Take out the text from the .name property
      var nameText = document.createTextNode(orgData[i].valueString);
      // Define a new <li> tag
      var strong = document.createElement('h1');
      // Append element to <ul> tag
      strong.appendChild(nameText);
targetUL.appendChild(strong);
return;

    }


    if (orgData[i].hasOwnProperty('item') && orgData[i].linkId =="7") {
      // Define new <ul> tag
     
      // Recurse
      titlePage(orgData[i].item, targetUL );
    }


 if (orgData[i].hasOwnProperty('answer')&& orgData[i].linkId =="8") {
      // Define new <ul> tag
    
      // Recurse
      titlePage(orgData[i].answer,targetUL );
    }


  }

  listOrg(orgData,document.getElementById("app"))
}













function listOrg(orgData,targetUL) {
  var i;
  for (i = 0; i < orgData.length; i++) {
    if (orgData[i].hasOwnProperty('text') && orgData[i].linkId !=="1") {
      // Take out the text from the .name property
      var nameText = document.createTextNode(orgData[i].text);
      // Define a new <li> tag
      var strong = document.createElement('strong');
       strong.appendChild(nameText);
      var newLI = document.createElement('li');
      // Append text to new <li> tage - newLI
      newLI.appendChild(strong);
      // Append element to <ul> tag
      targetUL.appendChild(newLI);
    }
 if (orgData[i].hasOwnProperty('valueString')  ) {
      // Take out the text from the .name property
      var nameText = document.createTextNode(orgData[i].valueString);
      // Define a new <li> tag
      var newLI = document.createElement('li');
      // Append text to new <li> tage - newLI
      newLI.appendChild(nameText);
      // Append element to <ul> tag
      targetUL.appendChild(newLI);
    }

if (orgData[i].hasOwnProperty('valueInteger') ) {
      // Take out the text from the .name property
      var nameText = document.createTextNode(orgData[i].valueInteger);
      // Define a new <li> tag
      var newLI = document.createElement('li');
      // Append text to new <li> tage - newLI
      newLI.appendChild(nameText);
      // Append element to <ul> tag
      targetUL.appendChild(newLI);
    }


    if (orgData[i].hasOwnProperty('valueCoding') ) {
      // Take out the text from the .name property
      var nameText = document.createTextNode(orgData[i].valueCoding.display);
      // Define a new <li> tag
      var newLI = document.createElement('li');
      // Append text to new <li> tage - newLI
      newLI.appendChild(nameText);
      // Append element to <ul> tag
      targetUL.appendChild(newLI);
    }


if (orgData[i].hasOwnProperty('valueBoolean')  ) {
      // Take out the text from the .name property
      var nameText = document.createTextNode(orgData[i].valueBoolean);


      // Define a new <li> tag
      var newLI = document.createElement('li');

      //this is me trying to create a checked input box.
//newLI.setAttribute("type", "checkbox");
 //document.body.appendChild(newLI)


      // Append text to new <li> tage - newLI
      newLI.appendChild(nameText);
      // Append element to <ul> tag
      targetUL.appendChild(newLI);
    }



    if (orgData[i].hasOwnProperty('item')) {
      // Define new <ul> tag
      var newUL = document.createElement('ul');
      // Append new <ul> tag
      var lowUl = targetUL.appendChild(newUL);
      // Select new lower level <ul> tag
      var lowUL = targetUL.querySelector('ul');
      // Recurse
      listOrg(orgData[i].item,newUL );
    }


 if (orgData[i].hasOwnProperty('answer')) {
      // Define new <ul> tag
      var newUL = document.createElement('ul');
      // Append new <ul> tag
      var lowUl = targetUL.appendChild(newUL);
      // Select new lower level <ul> tag
      var lowUL = targetUL.querySelector('ul');
      // Recurse
      listOrg(orgData[i].answer,newUL );
    }


  }
}


// CALL FUNCTION
//listOrg(myJSON.item,document.getElementById("app"));




  
//var myArray = JSON.stringify(myJSON.item);
//var jsonString=JSON.stringify(myJSON)
//var myArray=[myJSON.item];


/* doesnt work
function flat(array){
  var result=[];
  array.forEach(function(a){

    result.push(a);
    if (Array.isArray(a.item)){
      result=result.concat(flat(a.children));
    }
  });

  return result;
}

result=flat(myArray);
document.write(JSON.stringify(result, 0, 4));
/* this works as well--but places each element in an array
var myArray = myJSON.item

var flattenedArray=function(data) {
  return data.reduce(function iter(r, a) {

  if (a===null){

    return r;
  }

  if (Array.isArray(a)){

    return a.reduce(iter, r);
  }

  if (typeof a === 'object'){

    return Object.keys(a).map(k=> a[k]).reduce(iter, r);
  }
  return r.concat(a);
  }, []);
}
console.log(flattenedArray(myArray));
/*

//this is working- displaying main titles
function mapper(s) {
  if (Array.isArray(s)) {
    return s.map(mapper);

      `
    <div class="questions">
  <h2 class="question_text"> ${s.map(mapper)}</h2><br>

</div>

`
  }
  else {
    return s.text;
    `
    <div class="questions">
  <h2 class="question_text"> ${s.text}</h2>

</div>

`
  }
}

document.getElementById("app").innerHTML= 
`
${resultArray.map(mapper).join('')};

`

/*
  var myArray=Object.keys(myJSON.item).forEach(function (key){
    console.log(myJSON.item[key].text, myJSON.item[key].answer[0].valueCoding.display, myJSON.item[key].text);
console.log(myJSON.item.map(), myJSON.item[key].answer[0].valueCoding.display);
});

/*
function flat(array) {
    var result = [];
    array.forEach(function (a) {
        result.push(a);
        if (Array.isArray(a.children)) {
            result = result.concat(flat(a.children));
        }
    });
    return result;
}

var newjson=flat(myArray);



document.write(newjson);



document.getElementById("app").innerHTML=
`
<h class="ques">${myJSON.item[2].item[0].text}: </h>  
<h class="answ">${myJSON.item[2].item[0].answer[0].valueString} </h> <br>

<h class="ques">${myJSON.item[2].item[1].text}: </h>
<h class="answ">${myJSON.item[2].item[1].answer[0].valueString} </h><br>

<h class="ques">${myJSON.item[2].item[2].item[0].text}: </h>
<h class="answ">${myJSON.item[2].item[2].item[0].answer[0].valueString} </h><br>

<h class="ques">${myJSON.item[2].item[2].item[1].text}: </h>
<h class="answ">${myJSON.item[2].item[2].item[1].answer[0].valueString} </h>
`




/* Converting JSON object to JS object
    // data = JSON.parse(myJSON);
    
  //document.getElementById("app").innerHTML= myJSON.item[0].item[0].item[0].answer[0].valueString

/*
 function toArray(obj) {
    const result = [];
    for (const prop in obj) {
        const value = obj[prop];
        if (value && typeof value === 'object') { // exclude null
            result.push(...toArray(value));
            //          ^^^                          spread the array
        }
        else {
            result.push(value);
        }
    }
    return result;
}

function nameMatrioska(target) {
    return toArray(target);
}

var object = { name: 'grandma', daughter: { name: 'mother', daughter: { name: 'daughter', daughter: { name: 'granddaughter' } } } };

document.getElementById("app").innerHTML= nameMatrioska(myJSON);

/*
function itemList(qitem){

return `

<div class="questions">
  <h2 class="question_text"> ${qitem.text}</h>
<h6 class="question_text"> ${qitem.answer.map(answerList)}</h6>
</div>
`


}
function answerList(aitem){

return `

<div class="questions">
  <h2 class="question_text"> ${aitem.valueString}</h2>

</div>
`


}
 
  document.getElementById("app").innerHTML= `
  <h1 class="app-title">Items(${myJSON.item.length})</h1>
  
${myJSON.map(itemList).join('')}




  `



/*
function UserAction() {
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
         if (this.readyState == 4 && this.status == 200) {
             alert(this.responseText);
         }
    };
    xhttp.open("POST", "http://localhost:8080/hapi-fhir-jpaserver/fhir/Questionnaire", true);
    xhttp.setRequestHeader("Content-type", "application/json");
    xhttp.send(qr);
}


*/



var doc = new jsPDF();
var specialElementHandlers = {
    '#editor': function (element, renderer) {
        return true;
    }
};

$('#cmd').click(function () {
    doc.fromHTML($('#app').html(), 15, 15, {
        'width': 170,
            'elementHandlers': specialElementHandlers
    });
    doc.save('sample-file.pdf');
});












      </script>


  
<style type="text/css">
<!--
 .ques { margin-left: 200px; }
.answ { margin-left: 50px; }
-->
</style>

      



  
  </body>
</html>
